{% set products = craft.app.session.get('products') %}
{% set inStock = inStock ?? products.inStock ?? 0 %}
{% set prod1 = prod1 ?? products.prod1 ?? 1 %}
{% set prod2 = inStock ? 0 : (prod2 ?? products.prod2 ?? 1) %}
{% set prod3 = prod3 ?? products.prod3 ?? 1 %}
{% do craft.app.session.set('products', {
    inStock: inStock,
    prod1: prod1,
    prod2: prod2,
    prod3: prod3,
}) %}

<div class="mt-3 flex space-x-6">
    <div>
        {{ hiddenInput('inStock', inStock) }}
        <section aria-labelledby="cart-heading" class="lg:col-span-7">
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">Shopping Cart</h1>
                <div class="flex items-center ml-10 mt-1">
                    <!-- Enabled: "bg-green-700", Not Enabled: "bg-gray-200" -->
                    <button sprig s-val:in-stock="{{ inStock ? 0 : 1 }}" type="button" class="{{ inStock ? 'bg-green-700' : 'bg-gray-300' }} relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out outline-none ring-2 ring-green-500 ring-offset-2" role="switch" aria-checked="false" aria-labelledby="annual-billing-label">
                        <!-- Enabled: "translate-x-5", Not Enabled: "translate-x-0" -->
                        <span aria-hidden="true" class="{{ inStock ? 'translate-x-5' : 'translate-x-0' }} pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"></span>
                    </button>
                    <span class="ml-3 text-md" id="annual-billing-label">
                        <span class="font-medium text-gray-900">Only allow items in stock</span>
                      </span>
                </div>
            </div>
            <h2 id="cart-heading" class="sr-only">Items in your shopping cart</h2>
            <ul role="list" class="space-y-4">
                <li class="flex p-4 {{ not prod1 ? 'bg-gray-300' }}">
                    <div class="flex-shrink-0">
                        <img src="/src/images/shopping-cart-page-01-product-01.jpg" alt="Front of men&#039;s Basic Tee in sienna." class="h-24 w-24 rounded-md object-cover object-center sm:h-36 sm:w-36"/>
                    </div>
                    <div class="ml-4 flex flex-1 flex-col justify-between sm:ml-6">
                        <div class="relative pr-9 sm:grid sm:grid-cols-2 sm:gap-x-6 sm:pr-0">
                            <div>
                                <div class="flex justify-between">
                                    <h3 class="text-md">
                                        <a class="font-medium text-gray-700 hover:text-gray-800">Basic Tee</a>
                                    </h3>
                                </div>
                                <div class="mt-1 flex text-md">
                                    <p class="text-gray-500">Sienna</p>
                                    <p class="ml-4 border-l border-gray-200 pl-4 text-gray-500">Large</p>
                                </div>
                                <p class="mt-1 text-md font-medium text-gray-900">€32.00</p>
                            </div>

                            <div class="mt-4 sm:mt-0 sm:pr-9">
                                <select sprig name="prod1" class="form-select max-w-full rounded-md border border-gray-300 py-1.5 text-left text-base font-medium leading-5 text-gray-700 shadow-sm focus:border-sky-600 focus:outline-none focus:ring-1 focus:ring-sky-600 sm:text-md">
                                    {% if prod1 %}
                                        <option value="1" {{ prod1 == 1 ? 'selected' }}>1</option>
                                        <option value="2" {{ prod1 == 2 ? 'selected' }}>2</option>
                                        <option value="3" {{ prod1 == 3 ? 'selected' }}>3</option>
                                        <option value="4" {{ prod1 == 4 ? 'selected' }}>4</option>
                                        <option value="5" {{ prod1 == 5 ? 'selected' }}>5</option>
                                        <option value="6" {{ prod1 == 6 ? 'selected' }}>6</option>
                                        <option value="7" {{ prod1 == 7 ? 'selected' }}>7</option>
                                        <option value="8" {{ prod1 == 8 ? 'selected' }}>8</option>
                                    {% else %}
                                        <option value="0">0</option>
                                    {% endif %}
                                </select>

                                <div class="absolute right-0 top-0">
                                    {% if prod1 %}
                                        <button sprig s-val:prod1="0" type="button" class="-m-2 inline-flex p-2 text-gray-500 hover:text-gray-600">
                                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"/>
                                            </svg>
                                        </button>
                                    {% else %}
                                        <button sprig s-val:prod1="1" type="button" class="-m-2 inline-flex p-2 text-gray-500 hover:text-gray-600">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"/>
                                            </svg>
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        {% if prod1 %}
                            <p class="mt-4 flex space-x-2 text-md text-gray-700">
                                <svg class="h-5 w-5 flex-shrink-0 text-green-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd"/>
                                </svg>
                                <span>In stock</span>
                            </p>
                        {% else %}
                            <p class="mt-4 flex space-x-2 text-md text-red-600">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd"/>
                                </svg>
                                <span>Removed from cart</span>
                            </p>
                        {% endif %}
                    </div>
                </li>
                <li class="flex p-4 {{ not prod2 ? 'bg-gray-300' }}">
                    <div class="flex-shrink-0">
                        <img src="/src/images/shopping-cart-page-01-product-02.jpg" alt="" class="h-24 w-24 rounded-md object-cover object-center sm:h-36 sm:w-36"/>
                    </div>

                    <div class="ml-4 flex flex-1 flex-col justify-between sm:ml-6">
                        <div class="relative pr-9 sm:grid sm:grid-cols-2 sm:gap-x-6 sm:pr-0">
                            <div>
                                <div class="flex justify-between">
                                    <h3 class="text-md">
                                        <a class="font-medium text-gray-700 hover:text-gray-800">Daily Journal</a>
                                    </h3>
                                </div>
                                <div class="mt-1 flex text-md">
                                    <p class="text-gray-500">Black</p>
                                </div>
                                <p class="mt-1 text-md font-medium text-gray-900">€50.00</p>
                            </div>

                            <div class="mt-4 sm:mt-0 sm:pr-9">
                                <select sprig name="prod2" class="form-select max-w-full rounded-md border border-gray-300 py-1.5 text-left text-base font-medium leading-5 text-gray-700 shadow-sm focus:border-sky-600 focus:outline-none focus:ring-1 focus:ring-sky-600 sm:text-md">
                                    {% if prod2 %}
                                        <option value="1" {{ prod2 == 1 ? 'selected' }}>1</option>
                                        <option value="2" {{ prod2 == 2 ? 'selected' }}>2</option>
                                        <option value="3" {{ prod2 == 3 ? 'selected' }}>3</option>
                                        <option value="4" {{ prod2 == 4 ? 'selected' }}>4</option>
                                        <option value="5" {{ prod2 == 5 ? 'selected' }}>5</option>
                                        <option value="6" {{ prod2 == 6 ? 'selected' }}>6</option>
                                        <option value="7" {{ prod2 == 7 ? 'selected' }}>7</option>
                                        <option value="8" {{ prod2 == 8 ? 'selected' }}>8</option>
                                    {% else %}
                                        <option value="0">0</option>
                                    {% endif %}
                                </select>

                                <div class="absolute right-0 top-0">
                                    {% if prod2 %}
                                        <button sprig s-val:prod2="0" type="button" class="-m-2 inline-flex p-2 text-gray-500 hover:text-gray-600">
                                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"/>
                                            </svg>
                                        </button>
                                    {% else %}
                                        <button sprig s-val:prod2="1" type="button" class="-m-2 inline-flex p-2 text-gray-500 hover:text-gray-600">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"/>
                                            </svg>
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        {% if prod2 %}
                            <p class="mt-4 flex space-x-2 text-md text-gray-700">
                                <svg class="h-5 w-5 flex-shrink-0 text-gray-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd"/>
                                </svg>
                                <span>Ships in 3–4 weeks</span>
                            </p>
                        {% else %}
                            <p class="mt-4 flex space-x-2 text-md text-red-600">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd"/>
                                </svg>
                                <span>Removed from cart</span>
                            </p>
                        {% endif %}
                    </div>
                </li>
                <li class="flex p-4 {{ not prod3 ? 'bg-gray-300' }}">
                    <div class="flex-shrink-0">
                        <img src="/src/images/shopping-cart-page-01-product-03.jpg" alt="Insulated bottle with white base and black snap lid." class="h-24 w-24 rounded-md object-cover object-center sm:h-36 sm:w-36"/>
                    </div>

                    <div class="ml-4 flex flex-1 flex-col justify-between sm:ml-6">
                        <div class="relative pr-9 sm:grid sm:grid-cols-2 sm:gap-x-6 sm:pr-0">
                            <div>
                                <div class="flex justify-between">
                                    <h3 class="text-md">
                                        <a class="font-medium text-gray-700 hover:text-gray-800">Nomad Tumbler</a>
                                    </h3>
                                </div>
                                <div class="mt-1 flex text-md">
                                    <p class="text-gray-500">White</p>
                                </div>
                                <p class="mt-1 text-md font-medium text-gray-900">€35.00</p>
                            </div>

                            <div class="mt-4 sm:mt-0 sm:pr-9">
                                <select sprig name="prod3" class="form-select max-w-full rounded-md border border-gray-300 py-1.5 text-left text-base font-medium leading-5 text-gray-700 shadow-sm focus:border-sky-600 focus:outline-none focus:ring-1 focus:ring-sky-600 sm:text-md">
                                    {% if prod3 %}
                                        <option value="1" {{ prod3 == 1 ? 'selected' }}>1</option>
                                        <option value="2" {{ prod3 == 2 ? 'selected' }}>2</option>
                                        <option value="3" {{ prod3 == 3 ? 'selected' }}>3</option>
                                        <option value="4" {{ prod3 == 4 ? 'selected' }}>4</option>
                                        <option value="5" {{ prod3 == 5 ? 'selected' }}>5</option>
                                        <option value="6" {{ prod3 == 6 ? 'selected' }}>6</option>
                                        <option value="7" {{ prod3 == 7 ? 'selected' }}>7</option>
                                        <option value="8" {{ prod3 == 8 ? 'selected' }}>8</option>
                                    {% else %}
                                        <option value="0">0</option>
                                    {% endif %}
                                </select>

                                <div class="absolute right-0 top-0">
                                    {% if prod3 %}
                                        <button sprig s-val:prod3="0" type="button" class="-m-2 inline-flex p-2 text-gray-500 hover:text-gray-600">
                                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"/>
                                            </svg>
                                        </button>
                                    {% else %}
                                        <button sprig s-val:prod3="1" type="button" class="-m-2 inline-flex p-2 text-gray-500 hover:text-gray-600">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"/>
                                            </svg>
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        {% if prod3 %}
                            <p class="mt-4 flex space-x-2 text-md text-gray-700">
                                <svg class="h-5 w-5 flex-shrink-0 text-green-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd"/>
                                </svg>
                                <span>In stock</span>
                            </p>
                        {% else %}
                            <p class="mt-4 flex space-x-2 text-md text-red-600">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd"/>
                                </svg>
                                <span>Removed from cart</span>
                            </p>
                        {% endif %}
                    </div>
                </li>
            </ul>
        </section>
    </div>

    {% set prices = {
      prod1: 32,
      prod2: 50,
      prod3: 35,
    } %}
    {% set items = prod1 + prod2 + prod3 %}
    {% set postCode = postCode ?? '' %}
    {% set subtotal = (prod1 * prices['prod1']) + (prod2 * prices['prod2']) + (prod3 * prices['prod3']) %}
    {% set tax = subtotal * 0.2 %}
    {% set shipping = postCode == '08010' ? 0 : 5 %}
    {% set total = subtotal + tax + shipping %}

    <!-- Order summary -->
    <section aria-labelledby="summary-heading" class="lg:col-span-5 ">
        <div>
            <a class="group -m-2 flex items-center justify-end p-2">
                <div class="component cart w-24 h-10 flex items-center justify-end">
                    <svg class="h-8 w-8 flex-shrink-0 text-gray-600 group-hover:text-gray-700" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"></path>
                    </svg>
                    <span class="ml-2 text-lg font-medium text-gray-700 group-hover:text-gray-800">{{ items }}</span>
                    <span class="sr-only">items in cart, view bag</span>
                </div>
            </a>
        </div>
        <div class="mt-0 bg-gray-50 px-4 py-6 sm:p-6 lg:mt-5 lg:p-8 component">
            <h2 id="summary-heading" class="text-lg font-bold text-gray-900">Order summary</h2>

            <dl class="mt-6 space-y-4">
                <div class="flex items-center justify-between">
                    <dt class="text-md text-gray-700">Subtotal</dt>
                    <dd class="text-md font-medium text-gray-900">€{{ subtotal|number(2) }}</dd>
                </div>
                <div class="flex items-center justify-between border-t border-gray-200 pt-4">
                    <dt class="flex text-md text-gray-700">
                        <span>VAT</span>
                        <a title="VAT is charged at 20%." class="ml-2 flex-shrink-0 text-gray-500 hover:text-gray-600">
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.94 6.94a.75.75 0 11-1.061-1.061 3 3 0 112.871 5.026v.345a.75.75 0 01-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 108.94 6.94zM10 15a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                            </svg>
                        </a>
                    </dt>
                    <dd class="text-md font-medium text-gray-900">€{{ tax|number(2) }}</dd>
                </div>
                <div class="flex items-center justify-between border-t border-gray-200 pt-4">
                    <dt class="flex items-center text-md text-gray-700">
                        <span>Shipping costs</span>
                        <a title="Free shipping to “08010”." class="ml-2 flex-shrink-0 text-gray-500 hover:text-gray-600">
                            <span class="sr-only">Learn more about how shipping is calculated</span>
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.94 6.94a.75.75 0 11-1.061-1.061 3 3 0 112.871 5.026v.345a.75.75 0 01-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 108.94 6.94zM10 15a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                            </svg>
                        </a>
                    </dt>
                    <dd class="text-md font-medium text-gray-900">€{{ shipping|number(2) }}</dd>
                </div>
                <div class="flex items-center justify-between border-t border-gray-200 pt-4">
                    <dt class="text-base font-bold text-gray-900">Order total</dt>
                    <dd class="text-base font-bold text-gray-900">€{{ total|number(2) }}</dd>
                </div>
            </dl>
            <div class="flex mt-10 h-10 space-x-2">
                <input name="postCode" type="text" value="{{ postCode }}" class="form-input block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-600 focus:ring-2 focus:ring-inset focus:ring-sky-500 sm:text-md sm:leading-6" placeholder="Post code for shipping">
                <button sprig class="rounded-md border border-transparent bg-sky-700 px-2 py-1 text-base font-medium text-white shadow-sm hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-600 focus:ring-offset-2 focus:ring-offset-gray-50">Recalculate</button>
            </div>
            <div class="mt-6">
                <button class="w-full rounded-md border border-transparent bg-sky-700 px-4 py-3 text-base font-medium text-white shadow-sm hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-600 focus:ring-offset-2 focus:ring-offset-gray-50">Checkout</button>
            </div>
        </div>
    </section>
</div>
